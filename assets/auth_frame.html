<!DOCTYPE html>
<html>
<meta charset="utf-8">
<title>InterTwinkles Authentication Frame</title>
<style type='text/css'>
  html,body { margin: 0; padding: 0; border: 0; overflow: hidden; }
</style>
<body>
<a href='#' id='signin'><img src='/static/img/sign_in_blue.png' /></a>
<script src='https://login.persona.org/include.js'></script>
<script type='text/javascript'>
  var onmessage = function (event) {
    if (event.data != null && event.data.action == 'intertwinkles_logout') {
      navigator.id.logout();
    }
  }
  window.addEventListener('message', onmessage, false);

  document.getElementById('signin').onclick = function(event) {
    event.preventDefault();
    var opts = {
      siteName: "InterTwinkles",
      termsOfService: "/about/terms/",
      privacyPolicy: "/about/privacy/"
    }
    if (window.location.protocol == "https:") {
      opts.siteLogo = "/static/img/star-icon.png";
    }
    navigator.id.request(opts);
    return false;
  };

  navigator.id.watch({
    onlogin: function (assertion) {
      window.console && window.console.log && console.log("frame onlogin");
      window.parent.postMessage({action: 'onlogin', assertion: assertion}, '*');
    },
    onlogout: function () {
      window.console && window.console.log && console.log("frame onlogout");
      window.parent.postMessage({action: 'onlogout'}, '*');
    }
  });
</script>
</body>
</html>
